<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/iconfont.css" />
		<link rel="stylesheet" href="css/style.css" />
		<style>
			html,
			body  {
				/*background-color: #efeff4;*/
				background-color: transparent;
			}
			.mui-content {
				/*background-color: #efeff4;*/
				background-color: transparent;
			}
			.mui-table-view {
			    position: relative;
			    margin-top: 0;
			    margin-bottom: 0;
			    padding-left: 0;
			    list-style: none;
			    background-color: rgba(0, 0, 0, 0.3);
			    color: #fff;
			}
			.mui-table-view-cell>a:not(.mui-btn).mui-active {
			    background-color: rgba(0, 0, 0, 0.4);
			}
			.head-img {
				width: 42px!important;
				height: 41px!important;
			}
			.title{
				margin: 20px 15px 7px;
				color: #6d6d72;
				font-size: 15px;
			}
			.update {
				font-style: normal;
				color: #EEEEEE;
				margin-right: -25px;
				font-size: 15px
			}
			
			.list_icon {
				font-size: 18px;
				padding-right: 15px;
			}
			
			.password {
				color: #007AFF
			}
			.security {
				color: #DD524D
			}
			.contact {
				color: #FFCC33
			}
			.geofence {
				color: #EC971F
			}
			
			#circle img{ border-radius:50%}
			
		</style>
	</head>

	<body>
		<div class="mui-content">
			<!--<ul class="mui-table-view mui-table-view-chevron">
				<li class="mui-table-view-cell mui-media">
					<a id="account" class="mui-navigate-right" href="#">
						<div id="circle"><img class="mui-media-object mui-pull-left head-img" id="head-img" src="images/default.png"></div>
						<div class="mui-media-body">
							<span id="name">未设置</span>
							<p class='mui-ellipsis'>手机号：<span id="mobile">13310000000</span></p>
						</div>
					</a>
				</li>
			</ul>
			<div class="title"></div>-->
			<ul class="mui-table-view mui-table-view-chevron">
				<li class="mui-table-view-cell">
					<a id="password" class="mui-navigate-right"><i class="mui-icon iconfont icon-xiugaimima list_icon password"></i>修改密码</a>
				</li>
			</ul>
			<div class="title"></div>
			<ul class="mui-table-view mui-table-view-chevron">
				<li class="mui-table-view-cell">
					<a id="alert" class="mui-navigate-right"><i class="mui-icon iconfont icon-anquan list_icon security"></i>报警</a>
				</li>
				<!--<li class="mui-table-view-cell">
					<a id="geofence" class="mui-navigate-right"><i class="mui-icon iconfont icon-diliweilan1 list_icon geofence"></i>围栏设置</a>
				</li>
				<li class="mui-table-view-cell mui-hidden">
					<a id="contact" class="mui-navigate-right"><i class="mui-icon iconfont icon-lianxiren list_icon contact"></i>紧急联系人</a>
				</li>-->
				<!--<li class="mui-table-view-cell">
					<a href="#general" class="mui-navigate-right">通用</a>
				</li>-->
			</ul>
			<div class="title"></div>
			<ul class="mui-table-view mui-table-view-chevron">
				<li class="mui-table-view-cell">
					<a id="about" class="mui-navigate-right">版本号<i id="version" class="mui-pull-right update">V1.0.0</i></a>
				</li>
			</ul>
			<div class="title">
				
			</div>
			<ul class="mui-table-view">
				<li class="mui-table-view-cell" style="text-align: center;">
					<a id="exit">退出</a>
				</li>
			</ul>
		</div>
	</body>
	<script src="js/mui.min.js "></script>
	<script src="js/locales.js" ></script>
	<script src="js/wistorm/wspub.js"></script>
	<script src="js/wistorm/define.js"></script>
	<script src="js/wistorm/wistorm.js"></script>
	<script src="js/wistorm/md5.js"></script>	
	<script src="js/immersed.js" ></script>
	<script type="text/javascript" src="js/app.js" ></script>
	<script>
		mui.init();
		mui.plusReady(function(){
			var logo = document.getElementById('head-img');
			var name = document.getElementById('name');
			var mobile = document.getElementById('mobile');
			var version = document.getElementById('version');
			version.innerHTML = plus.runtime.version;			
			// 更新信息显示
			var loadCustomer = function(){
				// 设置个人信息
				var state = app.getState();
				logo.src = state.logo;
				name.innerHTML = state.name;
				mobile.innerHTML = state.account;
			};
			
//			loadCustomer();
			
//			window.addEventListener('refreshInfo', function(event){
//				loadCustomer();
//			});	
			
//			geofencePage = mui.preload({
//				"id": 'geofence-set',
//				"url": 'geofence-set.html'
//			});	
//			var geofenceButton = document.getElementById('geofence');
//			geofenceButton.addEventListener('tap', function(event) {
//				mui.fire(geofencePage, 'show');
//				setTimeout(function(){
//					geofencePage.show("pop-in");
//				}, 200);
//			});
//
//			var accountPage = mui.preload({
//					"id": 'account',
//					"url": 'account.html'
//				});
//			var account = document.getElementById('account');
//			account.addEventListener('tap', function(){
////				mui.openWindow({
////					url: 'account.html', 
////					id: 'account',
////					waiting:{
////	      				autoShow:false,//自动显示等待框，默认为true);
////	      			}
////				});
//				mui.fire(accountPage, 'show');
//				setTimeout(function(){
//					accountPage.show("pop-in");
//				}, 200);
//			},false);

			var alertButton = document.getElementById('alert');
			alertButton.addEventListener('tap', function(event) {
				var alertPage = plus.webview.getWebviewById('alert-list-main');
				mui.fire(alertPage, 'refreshAlertList', null);	
				setTimeout(function(){
					alertPage.show("pop-in");
				}, 200);
			});	
			
			var password = document.getElementById('password');
			password.addEventListener('tap', function(){
				mui.openWindow({
					url: 'forget_password.html', 
					id: 'forget_password',
					waiting:{
	      				autoShow:false,//自动显示等待框，默认为true);
	      			}
				});
			},false);
			
//			var security = document.getElementById('security');
//			security.addEventListener('tap', function(){
//				mui.openWindow({
//					url: 'security.html', 
//					id: 'security',
//					show:{
//    					autoShow:false //页面loaded事件发生后自动显示，默认为true
//    				},
//					waiting:{
//	      				autoShow:false //自动显示等待框，默认为true);
//	      			}
//				});
//			},false);
//			
//			var about = document.getElementById('about');
//			about.addEventListener('tap', function(){
//			var server = "https://wop-api.chease.cn/check/update"; //获取升级描述文件服务器地址
//				mui.getJSON(server, {
//					"appid": plus.runtime.appid,
//					"version": plus.runtime.version,
//					"imei": plus.device.imei,
//					"platform": plus.os.name
//				}, function(data) {
//					console.log(JSON.stringify(data));
//					if (data.status) {
//						plus.ui.confirm(data.note, function(i) {
//							if (0 == i) {
//								plus.runtime.openURL(data.url);
//							}
//						}, data.title, ["Update Now", "Cancel"]);
//					} else {
//						mui.toast('Already lastest version.')
//					}
//				});
//			},false);			
			
			//退出操作******************
			document.getElementById('exit').addEventListener('tap', function() {
				if (mui.os.ios) {
					app.setState({});
//					var state = app.getState();
//					state.token = "";
//					app.setState(state);
					app.updateTime = new Date(0);
//					mui.openWindow({
//						url: 'login.html',
//						id: 'login',
//						show: {
//							aniShow: 'pop-in'
//						},
//						waiting: {
//							autoShow: false
//						}
//					});
					plus.webview.getLaunchWebview().show("pop-in");
					return;
				}
				var btnArray = [{
					title: "退出账号"
				}, {
					title: "退出页面"
				}];
				plus.nativeUI.actionSheet({
					cancel: "取消",
					buttons: btnArray
				}, function(event) {
					var index = event.index;
					switch (index) {
						case 1:
							//注销账号
							app.setState({});
//							var state = app.getState();
//							state.token = "";
//							app.setState(state);
							app.updateTime = new Date(0);
							/*
							 * 注意：
							 * 1、因本示例应用启动页就是登录页面，因此注册成功后，直接显示登录页即可；
							 * 2、如果真实案例中，启动页不是登录页，则需修改，使用mui.openWindow打开真实的登录页面
							 */
							console.log('get state before logout: ' + JSON.stringify(app.getState()));
							plus.webview.getLaunchWebview().show("pop-in");
							break;
						case 2:
							plus.runtime.quit();
							break;
					}
				});
			}, false);
		});
	</script>

</html>